<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Gourav Shah">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Lab K113 - HELM and Kustomize - Kubernetes Tutorial with CKA/CKAD Prep</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Lab K113 - HELM and Kustomize";
    var mkdocs_page_input_path = "helm.md";
    var mkdocs_page_url = "/helm/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-36802546-16', 'kubernetes-tutorial.schoolofdevops.com');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Kubernetes Tutorial with CKA/CKAD Prep</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Just Enough Docker</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../operating-docker-containers/">Lab D101 - Operating Containers</a>
                </li>
                <li class="">
                    
    <a class="" href="../building-publishing-docker-images/">Lab D102 - Building and Publishing Docker Images</a>
                </li>
                <li class="">
                    
    <a class="" href="../docker-networking/">Lab D103 - Docker Networking</a>
                </li>
                <li class="">
                    
    <a class="" href="../docker-volumes/">Lab D104 - Docker Volumes</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Kubernetes CKA/CKAD Fundamentals</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../install_kubernetes_with_kubeadm/">Lab K101 - Install Kubernetes with Kubeadm</a>
                </li>
                <li class="">
                    
    <a class="" href="../kubernetes_quickdive/">Lab K102 - Kubernetes Quickdive</a>
                </li>
                <li class="">
                    
    <a class="" href="../create-and-deploy-kubernetes-pods/">Lab K103 - Pods Basics</a>
                </li>
                <li class="">
                    
    <a class="" href="../kubernetes-replicasets-howto/">Lab K104 - Namespaces and ReplicaSets</a>
                </li>
                <li class="">
                    
    <a class="" href="../kubernetes-service-networking/">Lab K105 - Services & Networking</a>
                </li>
                <li class="">
                    
    <a class="" href="../cni/">Lab K106 - CNI</a>
                </li>
                <li class="">
                    
    <a class="" href="../kubernetes-rollouts-rollbacks-deployments/">Lab K107 - Deployments</a>
                </li>
                <li class="">
                    
    <a class="" href="../kubernetes-dynamic-storage-provisioning/">Lab K108 - Storage</a>
                </li>
                <li class="">
                    
    <a class="" href="../kubernetes-sample-project/">Lab K109 - Mini Project</a>
                </li>
                <li class="">
                    
    <a class="" href="../kubernetes-configuration-management-configmaps-secrets/">Lab K110 - Configurations Management</a>
                </li>
                <li class="">
                    
    <a class="" href="../rbac_101/">Lab K111 - RBAC Concepts</a>
                </li>
                <li class="">
                    
    <a class="" href="../ingress/">Lab K112 - Application Routing with Ingress Controllers</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Lab K113 - HELM and Kustomize</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#lab-k205-monitoring-setup-with-helm">Lab K205 - Monitoring setup with HELM</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#installing-helm-version-3">Installing  Helm (version 3)</a></li>
        
            <li><a class="toctree-l4" href="#setup-a-repository-and-install-wordpress">Setup a repository and install Wordpress</a></li>
        
            <li><a class="toctree-l4" href="#install-prometheus-with-helm">Install Prometheus with Helm</a></li>
        
            <li><a class="toctree-l4" href="#summary">Summary</a></li>
        
        </ul>
    

    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">CKAD Topics</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../advanced_pod_design/">Lab K201 - Advanced Pod Design</a>
                </li>
                <li class="">
                    
    <a class="" href="../network_policies/">Lab K207 - Network Policies</a>
                </li>
                <li class="">
                    
    <a class="" href="../pods-health-probes/">Lab K204 - Observability and Application Troubleshooting</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">CKA Topics</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../10_kubernetes_autoscaling/">Lab K301 - Auto Scaling Capacity with HPA</a>
                </li>
                <li class="">
                    
    <a class="" href="../advanced_pod_scheduling/">Lab K302 - Advanced Pod Scheduling</a>
                </li>
                <li class="">
                    
    <a class="" href="../cluster-administration/">Lab K303 - Cluster Administration</a>
                </li>
                <li class="">
                    
    <a class="" href="../cluster-troubleshooting/">Lab K304 - Cluster Troubleshooting</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Additional Topics</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../configuring_authentication_and_authorization/">Lab K401 - Creating Users, Groups and Authorization</a>
                </li>
                <li class="">
                    
    <a class="" href="../13_redis_statefulset/">Lab K402 Statefulsets</a>
                </li>
                <li class="">
                    
    <a class="" href="../vote-deployement_strategies/">Lab K403 Building Deployment Strategies</a>
                </li>
                <li class="">
                    
    <a class="" href="../12_troubleshooting/">Troubleshooting Tips</a>
                </li>
                <li class="">
                    
    <a class="" href="../logging/">Logging</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Exercises</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../xer-001-pods/">XER001 - Pods</a>
                </li>
                <li class="">
                    
    <a class="" href="../xer-002-rs/">XER002 - ReplicaSets</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Web Quests</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../wq001-cni/">KWQ001 - CNI Web Quest</a>
                </li>
                <li class="">
                    
    <a class="" href="../wq002-security/">KWQ001 - Kubernetes Security Web Quest</a>
                </li>
                <li class="">
                    
    <a class="" href="../wq003-ingress/">KWQ003 - Ingress Web Quest</a>
                </li>
                <li class="">
                    
    <a class="" href="../wq004-monitoring/">KWQ004 - Monitoring Web Quest</a>
                </li>
                <li class="">
                    
    <a class="" href="../wq005-controllers/">KWQ005 - Controllers Web Quest</a>
                </li>
                <li class="">
                    
    <a class="" href="../wq006-persistentvolume/">KWQ006 - Persistent Data Web Quest</a>
                </li>
                <li class="">
                    
    <a class="" href="../wq007-maintenance/">KWQ007 - Cluster Maintenance Web Quest</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">References</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../rbac-resource-group-mapping/">RBAC apiGroups to Resource Mapping</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Kubernetes Tutorial with CKA/CKAD Prep</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Kubernetes CKA/CKAD Fundamentals &raquo;</li>
        
      
    
    <li>Lab K113 - HELM and Kustomize</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/schoolofdevops/kubernetes-labguide/edit/master/chapters/helm.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="lab-k205-monitoring-setup-with-helm">Lab K205 - Monitoring setup with HELM</h1>
<p>In this lab, you are going to install and configure helm, and in turns, use it to configure a monitoring system for kubernetes using prometheus and grafana stack.</p>
<h2 id="installing-helm-version-3">Installing  Helm (version 3)</h2>
<p>To install helm version 3, you can follow following instructions.</p>
<pre><code>curl https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3 | bash

</code></pre>

<p>Verify the installtion is successful,</p>
<pre><code>helm --help
helm version
</code></pre>

<h2 id="setup-a-repository-and-install-wordpress">Setup a repository and install Wordpress</h2>
<pre><code>helm repo add stable https://charts.helm.sh/stable

helm repo list
</code></pre>

<p>Try installing wordpress with helm</p>
<pre><code>helm search repo wordpress

helm install blog  stable/wordpress

kubectl get all -l &quot;release=blog&quot;
</code></pre>

<p>You could observe all the components deployed with the helm chart for wordpress. If both wordpress and mariadb pods are running, you should be able to access wordpress by using the nodePort. A Sample page looks like follows,  </p>
<p><img alt="Wordpress UI" src="../images/wordpress.png" /></p>
<p>Once you are done testing the wordpress application, to uninstall it, use the following sequence of commands.</p>
<pre><code>helm list
helm uninstall blog
kubectl get all -l &quot;release=blog&quot;
</code></pre>

<h2 id="install-prometheus-with-helm">Install Prometheus with Helm</h2>
<p>You will now setup prometheus and grafana monitoring stacks with helm, with a few customizations.</p>
<p>Before proceeding, you could review the <a href="https://github.com/helm/charts/tree/master/stable/prometheus">Official Prometheus Helm Chart</a>  from the repository.</p>
<p>Search and download a chart for prometheus</p>
<pre><code>cd ~
helm search repo prometheus
helm fetch --untar stable/prometheus
cd prometheus
</code></pre>

<p>To provide custom configurations, copy over the custom values file from <strong>k8s-code</strong> repot.</p>
<pre><code>cp ../k8s-code/helper/helm/values/prometheus-customvalues.yaml .
</code></pre>

<p>Review <strong>prometheus-customvalues.yaml</strong> and then launch prometheus stack as,</p>
<pre><code>helm install prometheus --values prometheus-customvalues.yaml  . --dry-run
helm install prometheus --values prometheus-customvalues.yaml  .

helm list
helm status prometheus

kubectl get all -l &quot;release=prometheus&quot;
</code></pre>

<p>You should be able to access prometheus UI by using either the <em>nodePort</em> service or a <em>ingress</em> rule.</p>
<h4 id="deploying-grafana-with-helm">Deploying Grafana with HELM</h4>
<p>You could refer to the <a href="https://github.com/helm/charts/tree/master/stable/grafana">Official Grafana Helm Chart repository</a> before proceeding.</p>
<p>Search and download a chart for prometheus</p>
<pre><code>cd ~
helm search repo grafana
helm fetch --untar stable/grafana
cd grafana
</code></pre>

<p>To provide custom configurations, copy over the custom values file from <strong>k8s-code</strong> repot.</p>
<pre><code>cp ../k8s-code/helper/helm/values/grafana-customvalues.yaml .
</code></pre>

<p>Review <strong>grafana-customvalues.yaml</strong> and then launch grafana as,</p>
<pre><code>helm install grafana --values grafana-customvalues.yaml  . --dry-run
helm install grafana --values grafana-customvalues.yaml  .

helm list
helm status grafana

kubectl get all -l &quot;release=grafana&quot;
</code></pre>

<p>You should be able to access grafana UI by using either the <em>nodePort</em> service or a <em>ingress</em> rule.</p>
<p><img alt="Grafana UI" src="../images/grafana.png" /></p>
<p>credentials for grafana</p>
<ul>
<li>user: admin</li>
<li>pass: password</li>
</ul>
<p>You could update it along with other values in <em>grafana-customvalues.yaml</em> or create a separate file to override the values.</p>
<p>If you update values and would like to apply to existing helm release, use a command simiar to following,</p>
<pre><code>helm upgrade -f grafana-customvalues.yaml grafana .
</code></pre>

<h2 id="summary">Summary</h2>
<p>In this lab, we not only learnt about HELM, a kubernetes package manager, but  also have setup a sophisticated health monitoring system with prometheus and grafana.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../advanced_pod_design/" class="btn btn-neutral float-right" title="Lab K201 - Advanced Pod Design">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../ingress/" class="btn btn-neutral" title="Lab K112 - Application Routing with Ingress Controllers"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright @ 2017-2020 Gourav Shah, School of Devops. Some rights reserved. License CC BY-NC-SA</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/schoolofdevops/kubernetes-labguide/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../ingress/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../advanced_pod_design/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
